"use strict";(self.webpackChunkreact_native_testing_library_website=self.webpackChunkreact_native_testing_library_website||[]).push([[494],{3905:function(e,t,n){n.d(t,{Zo:function(){return u},kt:function(){return y}});var a=n(7294);function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){i(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,a,i=function(e,t){if(null==e)return{};var n,a,i={},r=Object.keys(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}var p=a.createContext({}),s=function(e){var t=a.useContext(p),n=t;return e&&(n="function"==typeof e?e(t):o(o({},t),e)),n},u=function(e){var t=s(e.components);return a.createElement(p.Provider,{value:t},e.children)},d="mdxType",c={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},m=a.forwardRef((function(e,t){var n=e.components,i=e.mdxType,r=e.originalType,p=e.parentName,u=l(e,["components","mdxType","originalType","parentName"]),d=s(n),m=i,y=d["".concat(p,".").concat(m)]||d[m]||c[m]||r;return n?a.createElement(y,o(o({ref:t},u),{},{components:n})):a.createElement(y,o({ref:t},u))}));function y(e,t){var n=arguments,i=t&&t.mdxType;if("string"==typeof e||i){var r=n.length,o=new Array(r);o[0]=m;var l={};for(var p in t)hasOwnProperty.call(t,p)&&(l[p]=t[p]);l.originalType=e,l[d]="string"==typeof e?e:i,o[1]=l;for(var s=2;s<r;s++)o[s]=n[s];return a.createElement.apply(null,o)}return a.createElement.apply(null,n)}m.displayName="MDXCreateElement"},8787:function(e,t,n){n.r(t),n.d(t,{assets:function(){return u},contentTitle:function(){return p},default:function(){return y},frontMatter:function(){return l},metadata:function(){return s},toc:function(){return d}});var a=n(7462),i=n(3366),r=(n(7294),n(3905)),o=["components"],l={id:"migration-v2",title:"Migration to 2.0"},p=void 0,s={unversionedId:"migration-v2",id:"migration-v2",title:"Migration to 2.0",description:"This guide describes steps necessary to migrate from React Native Testing Library v1.x to v2.0.",source:"@site/docs/MigrationV2.md",sourceDirName:".",slug:"/migration-v2",permalink:"/react-native-testing-library/docs/migration-v2",draft:!1,editUrl:"https://github.com/callstack/react-native-testing-library/blob/main/website/docs/MigrationV2.md",tags:[],version:"current",frontMatter:{id:"migration-v2",title:"Migration to 2.0"},sidebar:"docs",previous:{title:"Migration to 7.0",permalink:"/react-native-testing-library/docs/migration-v7"},next:{title:"React Navigation",permalink:"/react-native-testing-library/docs/react-navigation"}},u={},d=[{value:"Dropping Node 8",id:"dropping-node-8",level:2},{value:"Auto Cleanup",id:"auto-cleanup",level:2},{value:"WaitFor API changes",id:"waitfor-api-changes",level:2},{value:"Removed global <code>debug</code> function",id:"removed-global-debug-function",level:2},{value:"Removed global <code>shallow</code> function",id:"removed-global-shallow-function",level:2},{value:"Removed functions",id:"removed-functions",level:2},{value:"Some <code>ByTestId</code> queries behavior changes",id:"some-bytestid-queries-behavior-changes",level:2},{value:"Deprecated <code>flushMicrotasksQueue</code>",id:"deprecated-flushmicrotasksqueue",level:2}],c={toc:d},m="wrapper";function y(e){var t=e.components,n=(0,i.Z)(e,o);return(0,r.kt)(m,(0,a.Z)({},c,n,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("p",null,"This guide describes steps necessary to migrate from React Native Testing Library ",(0,r.kt)("inlineCode",{parentName:"p"},"v1.x")," to ",(0,r.kt)("inlineCode",{parentName:"p"},"v2.0"),"."),(0,r.kt)("h2",{id:"dropping-node-8"},"Dropping Node 8"),(0,r.kt)("p",null,"Node 8 reached its EOL more than 5 months ago, so it's about time to target the library to Node 10. If you used lower version, you'll have to upgrade to v10, but we recommend using the latest LTS version."),(0,r.kt)("h2",{id:"auto-cleanup"},"Auto Cleanup"),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"cleanup()")," function is now called automatically after every test if your testing framework supports ",(0,r.kt)("inlineCode",{parentName:"p"},"afterEach")," hook (like Jest, Mocha, and Jasmine)."),(0,r.kt)("p",null,"You should be able to remove all ",(0,r.kt)("inlineCode",{parentName:"p"},"afterEach(cleanup)")," calls in your code."),(0,r.kt)("p",null,"This change might break your code, if you tests are not isolated, i.e. you call ",(0,r.kt)("inlineCode",{parentName:"p"},"render")," outside ",(0,r.kt)("inlineCode",{parentName:"p"},"test")," block. Generally, you should ",(0,r.kt)("a",{parentName:"p",href:"https://kentcdodds.com/blog/test-isolation-with-react"},"keep your tests isolated"),". But if you can't or don't want to do this right away you can prevent this behavior using any of the following ways:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"by importing ",(0,r.kt)("inlineCode",{parentName:"p"},"'react-native-testing-library/pure'")," instead of ",(0,r.kt)("inlineCode",{parentName:"p"},"'react-native-testing-library'"))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"by importing ",(0,r.kt)("inlineCode",{parentName:"p"},"'react-native-testing-library/dont-cleanup-after-each'")," before importing ",(0,r.kt)("inlineCode",{parentName:"p"},"'react-native-testing-library'"),". You can do it in a global way by using Jest's ",(0,r.kt)("inlineCode",{parentName:"p"},"setupFiles")," like this:"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "setupFiles": ["react-native-testing-library/dont-cleanup-after-each"];\n}\n'))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"by setting ",(0,r.kt)("inlineCode",{parentName:"p"},"RNTL_SKIP_AUTO_CLEANUP")," env variable to ",(0,r.kt)("inlineCode",{parentName:"p"},"true"),". You can do this with ",(0,r.kt)("inlineCode",{parentName:"p"},"cross-evn")," like this:"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-sh"},"cross-env RNTL_SKIP_AUTO_CLEANUP=true jest\n")))),(0,r.kt)("h2",{id:"waitfor-api-changes"},"WaitFor API changes"),(0,r.kt)("p",null,"We renamed ",(0,r.kt)("inlineCode",{parentName:"p"},"waitForElement")," function to ",(0,r.kt)("inlineCode",{parentName:"p"},"waitFor")," for consistency with React Testing Library. Additionally, the signature has slightly changed from:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-jsx"},"export default function waitForElement<T>(\n  expectation: () => T,\n  timeout?: number,\n  interval?: number\n): Promise<T> {}\n")),(0,r.kt)("p",null,"to:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-jsx"},"export default function waitFor<T>(\n  expectation: () => T,\n  options: {\n    timeout?: number,\n    interval?: number,\n  }\n): Promise<T> {}\n")),(0,r.kt)("p",null,"Both changes should improve code readibility."),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"waitFor")," calls (and hence also ",(0,r.kt)("inlineCode",{parentName:"p"},"findBy")," queries) are now wrapped in ",(0,r.kt)("inlineCode",{parentName:"p"},"act")," by default, so that you should no longer need to use ",(0,r.kt)("inlineCode",{parentName:"p"},"act")," directly in your tests."),(0,r.kt)("admonition",{type:"tip"},(0,r.kt)("p",{parentName:"admonition"},"You can usually avoid ",(0,r.kt)("inlineCode",{parentName:"p"},"waitFor")," by a proper use of ",(0,r.kt)("inlineCode",{parentName:"p"},"findBy")," asynchronous queries. It will result in more streamlined testing experience.")),(0,r.kt)("h2",{id:"removed-global-debug-function"},"Removed global ",(0,r.kt)("inlineCode",{parentName:"h2"},"debug")," function"),(0,r.kt)("p",null,"The ",(0,r.kt)("inlineCode",{parentName:"p"},"debug()")," method returned from ",(0,r.kt)("inlineCode",{parentName:"p"},"render()")," function is all you need. We removed the global export to avoid confusion."),(0,r.kt)("h2",{id:"removed-global-shallow-function"},"Removed global ",(0,r.kt)("inlineCode",{parentName:"h2"},"shallow")," function"),(0,r.kt)("p",null,"Shallow rendering React component is usually not a good idea, so we decided to remove the API. But, if you find it useful or need to support legacy tests, feel free to use this implementation:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},"import ShallowRenderer from 'react-test-renderer/shallow';\n\nexport function shallow(instance: ReactTestInstance | React.Element<any>) {\n  const renderer = new ShallowRenderer();\n  renderer.render(React.createElement(instance.type, instance.props));\n\n  return { output: renderer.getRenderOutput() };\n}\n")),(0,r.kt)("h2",{id:"removed-functions"},"Removed functions"),(0,r.kt)("p",null,"Following query functions have been removed after being deprecated for more than a year now:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"getByName")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"getAllByName")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"queryByName")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"queryAllByName"))),(0,r.kt)("p",null,"The ",(0,r.kt)("inlineCode",{parentName:"p"},"*ByType")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"*ByProps")," queries has been prefixed with ",(0,r.kt)("inlineCode",{parentName:"p"},"UNSAFE_"),". These ",(0,r.kt)("inlineCode",{parentName:"p"},"UNSAFE_")," functions are not planned for removal in future versions but their usage is discouraged. You can rename them using global search/replace in your project:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"getByType")," -> ",(0,r.kt)("inlineCode",{parentName:"li"},"UNSAFE_getByType")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"getAllByType")," -> ",(0,r.kt)("inlineCode",{parentName:"li"},"UNSAFE_getAllByType")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"queryByType")," -> ",(0,r.kt)("inlineCode",{parentName:"li"},"UNSAFE_queryByType")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"queryAllByType")," -> ",(0,r.kt)("inlineCode",{parentName:"li"},"UNSAFE_queryAllByType")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"getByProps")," -> ",(0,r.kt)("inlineCode",{parentName:"li"},"UNSAFE_getByProps")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"getAllByProps")," -> ",(0,r.kt)("inlineCode",{parentName:"li"},"UNSAFE_getAllByProps")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"queryByProps")," -> ",(0,r.kt)("inlineCode",{parentName:"li"},"UNSAFE_queryByProps")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"queryAllByProps")," -> ",(0,r.kt)("inlineCode",{parentName:"li"},"UNSAFE_queryAllByProps"))),(0,r.kt)("h2",{id:"some-bytestid-queries-behavior-changes"},"Some ",(0,r.kt)("inlineCode",{parentName:"h2"},"ByTestId")," queries behavior changes"),(0,r.kt)("p",null,"In version ",(0,r.kt)("inlineCode",{parentName:"p"},"1.x")," the ",(0,r.kt)("inlineCode",{parentName:"p"},"getByTestId")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"queryByTestId")," queries could return non-native instances. This was a serious bug. Other query functions like ",(0,r.kt)("inlineCode",{parentName:"p"},"getAllByTestId"),", ",(0,r.kt)("inlineCode",{parentName:"p"},"queryAllByTestId"),", ",(0,r.kt)("inlineCode",{parentName:"p"},"findByTestId")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"findAllByTestId")," didn't have this issue. These correctly returned only native components instances (e.g. ",(0,r.kt)("inlineCode",{parentName:"p"},"View"),", ",(0,r.kt)("inlineCode",{parentName:"p"},"Text"),", etc) that got the ",(0,r.kt)("inlineCode",{parentName:"p"},"testID"),"."),(0,r.kt)("p",null,"In v2 we fixed this inconsistency, which may result in failing tests, if you relied on this behavior. There are few ways to handle these failures:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"pass the ",(0,r.kt)("inlineCode",{parentName:"li"},"testID")," prop down so it can reach a native component, like ",(0,r.kt)("inlineCode",{parentName:"li"},"View")," or ",(0,r.kt)("inlineCode",{parentName:"li"},"Text")),(0,r.kt)("li",{parentName:"ul"},"replace ",(0,r.kt)("inlineCode",{parentName:"li"},"testID")," with proper ",(0,r.kt)("inlineCode",{parentName:"li"},"accessibilityHint")," or ",(0,r.kt)("inlineCode",{parentName:"li"},"accessibilityLabel")," if it benefits the user"),(0,r.kt)("li",{parentName:"ul"},"use safe queries like ",(0,r.kt)("inlineCode",{parentName:"li"},"*ByText")," or ",(0,r.kt)("inlineCode",{parentName:"li"},"*ByA11yHint"))),(0,r.kt)("h2",{id:"deprecated-flushmicrotasksqueue"},"Deprecated ",(0,r.kt)("inlineCode",{parentName:"h2"},"flushMicrotasksQueue")),(0,r.kt)("p",null,"We have deprecated ",(0,r.kt)("inlineCode",{parentName:"p"},"flushMicrotasksQueue")," and plan to remove it in the next major. We have better alternatives available for helping you write async tests \u2013 ",(0,r.kt)("inlineCode",{parentName:"p"},"findBy")," async queries and ",(0,r.kt)("inlineCode",{parentName:"p"},"waitFor")," helper."),(0,r.kt)("p",null,"If you can't or don't want to migrate your tests, don't worry. You can use the same implementation we have today:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},"function flushMicrotasksQueue() {\n  return new Promise((resolve) => setImmediate(resolve));\n}\n")))}y.isMDXComponent=!0}}]);